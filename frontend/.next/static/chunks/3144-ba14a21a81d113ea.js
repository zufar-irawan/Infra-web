(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3144],{13023:()=>{},32881:()=>{},45688:(e,t,i)=>{"use strict";var s=i(95704);i(86340);var r=i(12115),n=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(r),o=void 0!==s&&s.env&&!0,a=function(e){return"[object String]"===Object.prototype.toString.call(e)},l=function(){function e(e){var t=void 0===e?{}:e,i=t.name,s=void 0===i?"stylesheet":i,r=t.optimizeForSpeed,n=void 0===r?o:r;h(a(s),"`name` must be a string"),this._name=s,this._deletedRulePlaceholder="#"+s+"-deleted-rule____{}",h("boolean"==typeof n,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=n,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var l="undefined"!=typeof window&&document.querySelector('meta[property="csp-nonce"]');this._nonce=l?l.getAttribute("content"):null}var t,i=e.prototype;return i.setOptimizeForSpeed=function(e){h("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),h(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},i.isOptimizeForSpeed=function(){return this._optimizeForSpeed},i.inject=function(){var e=this;if(h(!this._injected,"sheet already injected"),this._injected=!0,"undefined"!=typeof window&&this._optimizeForSpeed){this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),this._optimizeForSpeed||(o||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0);return}this._serverSheet={cssRules:[],insertRule:function(t,i){return"number"==typeof i?e._serverSheet.cssRules[i]={cssText:t}:e._serverSheet.cssRules.push({cssText:t}),i},deleteRule:function(t){e._serverSheet.cssRules[t]=null}}},i.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]},i.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},i.insertRule=function(e,t){if(h(a(e),"`insertRule` accepts only strings"),"undefined"==typeof window)return"number"!=typeof t&&(t=this._serverSheet.cssRules.length),this._serverSheet.insertRule(e,t),this._rulesCount++;if(this._optimizeForSpeed){var i=this.getSheet();"number"!=typeof t&&(t=i.cssRules.length);try{i.insertRule(e,t)}catch(t){return o||console.warn("StyleSheet: illegal rule: \n\n"+e+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),-1}}else{var s=this._tags[t];this._tags.push(this.makeStyleTag(this._name,e,s))}return this._rulesCount++},i.replaceRule=function(e,t){if(this._optimizeForSpeed||"undefined"==typeof window){var i="undefined"!=typeof window?this.getSheet():this._serverSheet;if(t.trim()||(t=this._deletedRulePlaceholder),!i.cssRules[e])return e;i.deleteRule(e);try{i.insertRule(t,e)}catch(s){o||console.warn("StyleSheet: illegal rule: \n\n"+t+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),i.insertRule(this._deletedRulePlaceholder,e)}}else{var s=this._tags[e];h(s,"old rule at index `"+e+"` not found"),s.textContent=t}return e},i.deleteRule=function(e){if("undefined"==typeof window)return void this._serverSheet.deleteRule(e);if(this._optimizeForSpeed)this.replaceRule(e,"");else{var t=this._tags[e];h(t,"rule at index `"+e+"` not found"),t.parentNode.removeChild(t),this._tags[e]=null}},i.flush=function(){this._injected=!1,this._rulesCount=0,"undefined"!=typeof window?(this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]):this._serverSheet.cssRules=[]},i.cssRules=function(){var e=this;return"undefined"==typeof window?this._serverSheet.cssRules:this._tags.reduce(function(t,i){return i?t=t.concat(Array.prototype.map.call(e.getSheetForTag(i).cssRules,function(t){return t.cssText===e._deletedRulePlaceholder?null:t})):t.push(null),t},[])},i.makeStyleTag=function(e,t,i){t&&h(a(t),"makeStyleTag accepts only strings as second parameter");var s=document.createElement("style");this._nonce&&s.setAttribute("nonce",this._nonce),s.type="text/css",s.setAttribute("data-"+e,""),t&&s.appendChild(document.createTextNode(t));var r=document.head||document.getElementsByTagName("head")[0];return i?r.insertBefore(s,i):r.appendChild(s),s},t=[{key:"length",get:function(){return this._rulesCount}}],function(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}(e.prototype,t),e}();function h(e,t){if(!e)throw Error("StyleSheet: "+t+".")}var c=function(e){for(var t=5381,i=e.length;i;)t=33*t^e.charCodeAt(--i);return t>>>0},p={};function d(e,t){if(!t)return"jsx-"+e;var i=String(t),s=e+i;return p[s]||(p[s]="jsx-"+c(e+"-"+i)),p[s]}function u(e,t){"undefined"==typeof window&&(t=t.replace(/\/style/gi,"\\/style"));var i=e+t;return p[i]||(p[i]=t.replace(/__jsx-style-dynamic-selector/g,e)),p[i]}var v=function(){function e(e){var t=void 0===e?{}:e,i=t.styleSheet,s=void 0===i?null:i,r=t.optimizeForSpeed,n=void 0!==r&&r;this._sheet=s||new l({name:"styled-jsx",optimizeForSpeed:n}),this._sheet.inject(),s&&"boolean"==typeof n&&(this._sheet.setOptimizeForSpeed(n),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var t=e.prototype;return t.add=function(e){var t=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),"undefined"==typeof window||this._fromServer||(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,t){return e[t]=0,e},{}));var i=this.getIdAndRules(e),s=i.styleId,r=i.rules;if(s in this._instancesCounts){this._instancesCounts[s]+=1;return}var n=r.map(function(e){return t._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[s]=n,this._instancesCounts[s]=1},t.remove=function(e){var t=this,i=this.getIdAndRules(e).styleId;if(function(e,t){if(!e)throw Error("StyleSheetRegistry: "+t+".")}(i in this._instancesCounts,"styleId: `"+i+"` not found"),this._instancesCounts[i]-=1,this._instancesCounts[i]<1){var s=this._fromServer&&this._fromServer[i];s?(s.parentNode.removeChild(s),delete this._fromServer[i]):(this._indices[i].forEach(function(e){return t._sheet.deleteRule(e)}),delete this._indices[i]),delete this._instancesCounts[i]}},t.update=function(e,t){this.add(t),this.remove(e)},t.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},t.cssRules=function(){var e=this,t=this._fromServer?Object.keys(this._fromServer).map(function(t){return[t,e._fromServer[t]]}):[],i=this._sheet.cssRules();return t.concat(Object.keys(this._indices).map(function(t){return[t,e._indices[t].map(function(e){return i[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},t.styles=function(e){var t,i;return t=this.cssRules(),void 0===(i=e)&&(i={}),t.map(function(e){var t=e[0],s=e[1];return n.default.createElement("style",{id:"__"+t,key:"__"+t,nonce:i.nonce?i.nonce:void 0,dangerouslySetInnerHTML:{__html:s}})})},t.getIdAndRules=function(e){var t=e.children,i=e.dynamic,s=e.id;if(i){var r=d(s,i);return{styleId:r,rules:Array.isArray(t)?t.map(function(e){return u(r,e)}):[u(r,t)]}}return{styleId:d(s),rules:Array.isArray(t)?t:[t]}},t.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,t){return e[t.id.slice(2)]=t,e},{})},e}(),g=r.createContext(null);g.displayName="StyleSheetContext";var m=n.default.useInsertionEffect||n.default.useLayoutEffect,f="undefined"!=typeof window?new v:void 0;function y(e){var t=f||r.useContext(g);return t&&("undefined"==typeof window?t.add(e):m(function(){return t.add(e),function(){t.remove(e)}},[e.id,String(e.dynamic)])),null}y.dynamic=function(e){return e.map(function(e){return d(e[0],e[1])}).join(" ")},t.style=y},50108:(e,t,i)=>{"use strict";i.d(t,{b:()=>ed});var s=i(12690),r=i(85339),n=Object.defineProperty;((e,t)=>{for(var i in t)n(e,i,{get:t[i],enumerable:!0})})({},{EnterMarkerEvent:()=>v,GotoMarkerDoneEvent:()=>c,HideMarkersEvent:()=>E,LeaveMarkerEvent:()=>d,MarkerVisibilityEvent:()=>l,MarkersPluginEvent:()=>o,RenderMarkersListEvent:()=>A,SelectMarkerEvent:()=>m,SelectMarkerListEvent:()=>y,SetMarkersEvent:()=>S,ShowMarkersEvent:()=>x,UnselectMarkerEvent:()=>k});var o=class extends s.rx{},a=class e extends o{constructor(t,i){super(e.type),this.marker=t,this.visible=i}};a.type="marker-visibility";var l=a,h=class e extends o{constructor(t){super(e.type),this.marker=t}};h.type="goto-marker-done";var c=h,p=class e extends o{constructor(t){super(e.type),this.marker=t}};p.type="leave-marker";var d=p,u=class e extends o{constructor(t){super(e.type),this.marker=t}};u.type="enter-marker";var v=u,g=class e extends o{constructor(t,i,s){super(e.type),this.marker=t,this.doubleClick=i,this.rightClick=s}};g.type="select-marker";var m=g,f=class e extends o{constructor(t){super(e.type),this.marker=t}};f.type="select-marker-list";var y=f,w=class e extends o{constructor(t){super(e.type),this.marker=t}};w.type="unselect-marker";var k=w,b=class e extends o{constructor(){super(e.type)}};b.type="hide-markers";var E=b,_=class e extends o{constructor(t){super(e.type),this.markers=t}};_.type="set-markers";var S=_,M=class e extends o{constructor(){super(e.type)}};M.type="show-markers";var x=M,C=class e extends o{constructor(t){super(e.type),this.markers=t}};C.type="render-markers-list";var A=C,P=class extends s.Np{constructor(e){super(e,{className:"psv-markers-button",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="10 9 81 81"><path fill="currentColor" d="M50.5 90S22.9 51.9 22.9 36.6 35.2 9 50.5 9s27.6 12.4 27.6 27.6S50.5 90 50.5 90zm0-66.3c-6.1 0-11 4.9-11 11s4.9 11 11 11 11-4.9 11-11-4.9-11-11-11z"/>\x3c!--Created by Rohith M S from the Noun Project--\x3e</svg>\n',hoverScale:!0,collapsable:!0,tabbable:!0}),this.plugin=this.viewer.getPlugin("markers"),this.plugin&&(this.plugin.addEventListener(x.type,this),this.plugin.addEventListener(E.type,this),this.toggleActive(!0))}destroy(){this.plugin&&(this.plugin.removeEventListener(x.type,this),this.plugin.removeEventListener(E.type,this)),super.destroy()}isSupported(){return!!this.plugin}handleEvent(e){e instanceof x?this.toggleActive(!0):e instanceof E&&this.toggleActive(!1)}onClick(){this.plugin.toggleAllMarkers()}};P.id="markers";var z='<svg xmlns="http://www.w3.org/2000/svg" viewBox="9 9 81 81"><path fill="currentColor" d="M37.5 90S9.9 51.9 9.9 36.6 22.2 9 37.5 9s27.6 12.4 27.6 27.6S37.5 90 37.5 90zm0-66.3c-6.1 0-11 4.9-11 11s4.9 11 11 11 11-4.9 11-11-4.9-11-11-11zM86.7 55H70c-1.8 0-3.3-1.5-3.3-3.3s1.5-3.3 3.3-3.3h16.7c1.8 0 3.3 1.5 3.3 3.3S88.5 55 86.7 55zm0-25h-15a3.3 3.3 0 0 1-3.3-3.3c0-1.8 1.5-3.3 3.3-3.3h15c1.8 0 3.3 1.5 3.3 3.3 0 1.8-1.5 3.3-3.3 3.3zM56.5 73h30c1.8 0 3.3 1.5 3.3 3.3 0 1.8-1.5 3.3-3.3 3.3h-30a3.3 3.3 0 0 1-3.3-3.3 3.2 3.2 0 0 1 3.3-3.3z"/>\x3c!--Created by Rohith M S from the Noun Project--\x3e</svg>\n',L="http://www.w3.org/2000/svg",T="psvMarker",j=s.Wp.dasherize(T),O="marker",R="markersList",D={amount:2,duration:100,easing:"linear"},W=class extends s.Np{constructor(e){super(e,{className:" psv-markers-list-button",icon:z,hoverScale:!0,collapsable:!0,tabbable:!0}),this.plugin=this.viewer.getPlugin("markers"),this.plugin&&(this.viewer.addEventListener(s.AZ.ShowPanelEvent.type,this),this.viewer.addEventListener(s.AZ.HidePanelEvent.type,this))}destroy(){this.viewer.removeEventListener(s.AZ.ShowPanelEvent.type,this),this.viewer.removeEventListener(s.AZ.HidePanelEvent.type,this),super.destroy()}isSupported(){return!!this.plugin}handleEvent(e){e instanceof s.AZ.ShowPanelEvent?this.toggleActive(e.panelId===R):e instanceof s.AZ.HidePanelEvent&&this.toggleActive(!1)}onClick(){this.plugin.toggleMarkersList()}};W.id="markersList";var I=new r.Pq0,N=new r.PTz,Z=new r.Pq0,H=class extends r.B69{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&null!==e.element.parentNode&&e.element.remove()})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}},F=new r.kn4,$=new r.kn4,V=class{constructor(e={}){let t,i,s,r,n=this,o={camera:{style:""},objects:new WeakMap},a=void 0!==e.element?e.element:document.createElement("div");a.style.overflow="hidden",this.domElement=a;let l=document.createElement("div");l.style.transformOrigin="0 0",l.style.pointerEvents="none",a.appendChild(l);let h=document.createElement("div");function c(e){return 1e-10>Math.abs(e)?0:e}function p(e){let t=e.elements;return"matrix3d("+c(t[0])+","+c(-t[1])+","+c(t[2])+","+c(t[3])+","+c(t[4])+","+c(-t[5])+","+c(t[6])+","+c(t[7])+","+c(t[8])+","+c(-t[9])+","+c(t[10])+","+c(t[11])+","+c(t[12])+","+c(-t[13])+","+c(t[14])+","+c(t[15])+")"}function d(e){let t=e.elements;return"translate(-50%,-50%)"+("matrix3d("+c(t[0])+","+c(t[1])+","+c(t[2])+","+c(t[3])+","+c(-t[4])+","+c(-t[5])+","+c(-t[6])+","+c(-t[7])+","+c(t[8])+","+c(t[9])+","+c(t[10])+","+c(t[11])+","+c(t[12])+","+c(t[13])+","+c(t[14])+","+c(t[15]))+")"}h.style.transformStyle="preserve-3d",l.appendChild(h),this.getSize=function(){return{width:t,height:i}},this.render=function(e,a){let u,v,g=a.projectionMatrix.elements[5]*r;a.view&&a.view.enabled?(l.style.transform=`translate( ${-a.view.offsetX*(t/a.view.width)}px, ${-a.view.offsetY*(i/a.view.height)}px )`,l.style.transform+=`scale( ${a.view.fullWidth/a.view.width}, ${a.view.fullHeight/a.view.height} )`):l.style.transform="",!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===a.parent&&!0===a.matrixWorldAutoUpdate&&a.updateMatrixWorld(),a.isOrthographicCamera&&(u=-(a.right+a.left)/2,v=(a.top+a.bottom)/2);let m=a.view&&a.view.enabled?a.view.height/a.view.fullHeight:1,f=a.isOrthographicCamera?`scale( ${m} )scale(`+g+")translate("+c(u)+"px,"+c(v)+"px)"+p(a.matrixWorldInverse):`scale( ${m} )translateZ(`+g+"px)"+p(a.matrixWorldInverse),y=(a.isPerspectiveCamera?"perspective("+g+"px) ":"")+f+"translate("+s+"px,"+r+"px)";o.camera.style!==y&&(h.style.transform=y,o.camera.style=y),function e(t,i,s,r){if(!1===t.visible)return void function e(t){t.isCSS3DObject&&(t.element.style.display="none");for(let i=0,s=t.children.length;i<s;i++)e(t.children[i])}(t);if(t.isCSS3DObject){let e=!0===t.layers.test(s.layers),r=t.element;if(r.style.display=!0===e?"":"none",!0===e){let e;t.onBeforeRender(n,i,s),t.isCSS3DSprite?(F.copy(s.matrixWorldInverse),F.transpose(),0!==t.rotation2D&&F.multiply($.makeRotationZ(t.rotation2D)),t.matrixWorld.decompose(I,N,Z),F.setPosition(I),F.scale(Z),F.elements[3]=0,F.elements[7]=0,F.elements[11]=0,F.elements[15]=1,e=d(F)):e=d(t.matrixWorld);let a=o.objects.get(t);if(void 0===a||a.style!==e){r.style.transform=e;let i={style:e};o.objects.set(t,i)}r.parentNode!==h&&h.appendChild(r),t.onAfterRender(n,i,s)}}for(let n=0,o=t.children.length;n<o;n++)e(t.children[n],i,s,r)}(e,e,a,f)},this.setSize=function(e,n){t=e,i=n,s=t/2,r=i/2,a.style.width=e+"px",a.style.height=n+"px",l.style.width=e+"px",l.style.height=n+"px",h.style.width=e+"px",h.style.height=n+"px"}}},U=class{constructor(e){this.viewer=e,this.element=document.createElement("div"),this.element.className="psv-markers-css3d-container",this.renderer=new V({element:this.element}),this.scene=new r.Z58,this.intersectionObserver=new IntersectionObserver(e=>{e.forEach(e=>{let t=e.target[T];t.config.visible&&(t.viewportIntersection=e.isIntersecting)})},{root:this.element}),e.addEventListener(s.AZ.ReadyEvent.type,this,{once:!0}),e.addEventListener(s.AZ.SizeUpdatedEvent.type,this),e.addEventListener(s.AZ.RenderEvent.type,this)}handleEvent(e){switch(e.type){case s.AZ.ReadyEvent.type:case s.AZ.SizeUpdatedEvent.type:this.updateSize();break;case s.AZ.RenderEvent.type:this.render()}}destroy(){this.viewer.removeEventListener(s.AZ.ReadyEvent.type,this),this.viewer.removeEventListener(s.AZ.SizeUpdatedEvent.type,this),this.viewer.removeEventListener(s.AZ.RenderEvent.type,this),this.intersectionObserver.disconnect()}updateSize(){let e=this.viewer.getSize();this.renderer.setSize(e.width,e.height)}render(){this.renderer.render(this.scene,this.viewer.renderer.camera)}addObject(e){this.scene.add(e.threeElement),this.intersectionObserver.observe(e.domElement)}removeObject(e){this.scene.remove(e.threeElement),this.intersectionObserver.unobserve(e.domElement)}},q=(e=>(e.image="image",e.html="html",e.element="element",e.imageLayer="imageLayer",e.videoLayer="videoLayer",e.elementLayer="elementLayer",e.polygon="polygon",e.polygonPixels="polygonPixels",e.polyline="polyline",e.polylinePixels="polylinePixels",e.square="square",e.rect="rect",e.circle="circle",e.ellipse="ellipse",e.path="path",e))(q||{});function B(e,t=!1){let i=[];if(Object.keys(q).forEach(t=>{e[t]&&i.push(t)}),0!==i.length||t){if(i.length>1)throw new s.e6(`multiple marker content, either ${Object.keys(q).join(", ")}`)}else throw new s.e6(`missing marker content, either ${Object.keys(q).join(", ")}`);return i[0]}var Y=class{constructor(e,t,i){if(this.viewer=e,this.plugin=t,this.state={anchor:null,visible:!1,staticTooltip:!1,position:null,position2D:null,positions3D:null,size:null},!i.id)throw new s.e6("missing marker id");this.type=B(i),this.createElement(),this.update(i)}get id(){return this.config.id}get data(){return this.config.data}get domElement(){return null}get threeElement(){return null}get video(){return null}destroy(){delete this.viewer,delete this.plugin,delete this.element,this.hideTooltip()}is3d(){return!1}isNormal(){return!1}isPoly(){return!1}isSvg(){return!1}isCss3d(){return!1}update(e){let t=B(e,!0);if(void 0!==t&&t!==this.type)throw new s.e6(`cannot change marker ${e.id} type`);if(this.config=s.Wp.deepmerge(this.config,e),"string"==typeof this.config.tooltip&&(this.config.tooltip={content:this.config.tooltip}),this.config.tooltip&&!this.config.tooltip.trigger&&(this.config.tooltip.trigger="hover"),s.Wp.isNil(this.config.visible)&&(this.config.visible=!0),s.Wp.isNil(this.config.zIndex)&&(this.config.zIndex=1),s.Wp.isNil(this.config.opacity)&&(this.config.opacity=1),this.config.rotation){let e=this.config.rotation;"object"==typeof e?this.config.rotation={yaw:e.yaw?s.Wp.parseAngle(e.yaw,!0,!1):0,pitch:e.pitch?s.Wp.parseAngle(e.pitch,!0,!1):0,roll:e.roll?s.Wp.parseAngle(e.roll,!0,!1):0}:this.config.rotation={yaw:0,pitch:0,roll:s.Wp.parseAngle(e,!0,!1)}}else this.config.rotation={yaw:0,pitch:0,roll:0};this.state.anchor=s.Wp.parsePoint(this.config.anchor)}getListContent(){return this.config.listContent?this.config.listContent:this.config.tooltip?.content?this.config.tooltip.content:this.config.html?this.config.html:this.id}showTooltip(e,t,i=!1){if(this.state.visible&&this.config.tooltip?.content&&this.state.position2D){let r={...this.config.tooltip,style:{pointerEvents:this.state.staticTooltip?"auto":"none"},data:this,top:0,left:0};if(this.isPoly()||this.is3d()||this.isCss3d())if(e||t){let i=s.Wp.getPosition(this.viewer.container);r.top=t-i.y+10,r.left=e-i.x,r.box={width:20,height:20}}else r.top=this.state.position2D.y,r.left=this.state.position2D.x;else{let e=this.viewer.dataHelper.vector3ToViewerCoords(this.state.positions3D[0]),t=this.state.size.width,i=this.state.size.height;this.config.hoverScale&&!this.state.staticTooltip&&(t*=this.config.hoverScale.amount,i*=this.config.hoverScale.amount),r.top=e.y-i*this.state.anchor.y+i/2,r.left=e.x-t*this.state.anchor.x+t/2,r.box={width:t,height:i}}this.tooltip?i?this.tooltip.update(this.config.tooltip.content,r):this.tooltip.move(r):this.tooltip=this.viewer.createTooltip(r)}}hideTooltip(){this.tooltip&&(this.tooltip.hide(),this.tooltip=null)}},K=class extends Y{get domElement(){return this.element}constructor(e,t,i){super(e,t,i)}afterCreateElement(){this.element[T]=this}destroy(){delete this.element[T],super.destroy()}update(e){super.update(e);let t=this.domElement;t.id=`psv-marker-${this.config.id}`,t.setAttribute("class","psv-marker"),this.state.visible&&t.classList.add("psv-marker--visible"),this.config.tooltip&&t.classList.add("psv-marker--has-tooltip"),this.config.content&&t.classList.add("psv-marker--has-content"),this.config.className&&s.Wp.addClasses(t,this.config.className),t.style.opacity=`${this.config.opacity}`,t.style.zIndex=`${30+this.config.zIndex}`,this.config.style&&Object.assign(t.style,this.config.style)}},X=class extends K{constructor(e,t,i){super(e,t,i)}afterCreateElement(){super.afterCreateElement(),this.domElement.addEventListener("transitionend",()=>{this.domElement.style.transition=""})}render({viewerPosition:e,zoomLevel:t,hoveringMarker:i}){this.__updateSize();let s=this.viewer.dataHelper.vector3ToViewerCoords(this.state.positions3D[0]);return(s.x-=this.state.size.width*this.state.anchor.x,s.y-=this.state.size.height*this.state.anchor.y,this.state.positions3D[0].dot(this.viewer.state.direction)>0&&s.x+this.state.size.width>=0&&s.x-this.state.size.width<=this.viewer.state.size.width&&s.y+this.state.size.height>=0&&s.y-this.state.size.height<=this.viewer.state.size.height)?(this.domElement.style.translate=`${s.x}px ${s.y}px 0px`,this.applyScale({zoomLevel:t,viewerPosition:e,mouseover:this===i}),s):null}update(e){if(super.update(e),!s.Wp.isExtendedPosition(this.config.position))throw new s.e6(`missing marker ${this.id} position`);try{this.state.position=this.viewer.dataHelper.cleanPosition(this.config.position)}catch(e){throw new s.e6(`invalid marker ${this.id} position`,e)}this.state.positions3D=[this.viewer.dataHelper.sphericalCoordsToVector3(this.state.position)];let t=this.domElement;t.classList.add("psv-marker--normal"),this.config.scale&&Array.isArray(this.config.scale)&&(this.config.scale={zoom:this.config.scale}),"boolean"==typeof this.config.hoverScale?this.config.hoverScale=this.config.hoverScale?this.plugin.config.defaultHoverScale||D:null:"number"==typeof this.config.hoverScale?this.config.hoverScale={amount:this.config.hoverScale}:this.config.hoverScale||(this.config.hoverScale=this.plugin.config.defaultHoverScale),this.config.hoverScale&&(this.config.hoverScale={...this.plugin.config.defaultHoverScale,...this.config.hoverScale}),t.style.rotate=0!==this.config.rotation.roll?r.cj9.radToDeg(this.config.rotation.roll)+"deg":null,t.style.transformOrigin=`${100*this.state.anchor.x}% ${100*this.state.anchor.y}%`}__updateSize(){if(!this.needsUpdateSize)return;let e=this.domElement,t=!this.state.visible||!this.state.size;if(t&&e.classList.add("psv-marker--transparent"),this.isSvg()){let t=e.firstElementChild.getBoundingClientRect();this.state.size={width:t.width,height:t.height}}else this.state.size={width:e.offsetWidth,height:e.offsetHeight};t&&e.classList.remove("psv-marker--transparent"),this.isSvg()&&(e.style.width=this.state.size.width+"px",e.style.height=this.state.size.height+"px"),"element"!==this.type&&(this.needsUpdateSize=!1)}applyScale({zoomLevel:e,viewerPosition:t,mouseover:i}){null!==i&&this.config.hoverScale&&(this.domElement.style.transition=`scale ${this.config.hoverScale.duration}ms ${this.config.hoverScale.easing}`);let n=1;if("function"==typeof this.config.scale)n=this.config.scale(e,t);else if(this.config.scale){if(Array.isArray(this.config.scale.zoom)){let[t,i]=this.config.scale.zoom;n*=t+(i-t)*s.aH.EASINGS.inQuad(e/100)}if(Array.isArray(this.config.scale.yaw)){let[e,i]=this.config.scale.yaw,o=r.cj9.degToRad(this.viewer.state.hFov)/2,a=Math.abs(s.Wp.getShortestArc(this.state.position.yaw,t.yaw));n*=i+(e-i)*s.aH.EASINGS.outQuad(Math.max(0,(o-a)/o))}}i&&this.config.hoverScale&&(n*=this.config.hoverScale.amount),this.domElement.style.scale=`${n}`}},G=class extends r.BKk{get map(){return this.uniforms.map.value}set map(e){this.uniforms.map.value=e}set alpha(e){this.uniforms.alpha.value=e}get offset(){return this.uniforms.offset.value}get repeat(){return this.uniforms.repeat.value}set chromaKey(e){this.uniforms.keying.value=e?.enabled===!0,e?.enabled&&("object"==typeof e.color&&"r"in e.color?this.uniforms.color.value.set(e.color.r/255,e.color.g/255,e.color.b/255):this.uniforms.color.value.set(e.color??65280),this.uniforms.similarity.value=e.similarity??.2,this.uniforms.smoothness.value=e.smoothness??.2)}constructor(e){super({transparent:!0,depthTest:!1,depthWrite:!1,uniforms:{map:{value:e?.map},repeat:{value:new r.I9Y(1,1)},offset:{value:new r.I9Y(0,0)},alpha:{value:e?.alpha??1},keying:{value:!1},color:{value:new r.Q1f(65280)},similarity:{value:.2},smoothness:{value:.2},spill:{value:.1}},vertexShader:"varying vec2 vUv;\nuniform vec2 repeat;\nuniform vec2 offset;\n\nvoid main() {\n    vUv = uv * repeat + offset;\n    gl_Position = projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );\n}\n",fragmentShader:"// https://www.8thwall.com/playground/chromakey-threejs\n\nuniform sampler2D map;\nuniform float alpha;\nuniform bool keying;\nuniform vec3 color;\nuniform float similarity;\nuniform float smoothness;\nuniform float spill;\n\nvarying vec2 vUv;\n\nvec2 RGBtoUV(vec3 rgb) {\n    return vec2(\n        rgb.r * -0.169 + rgb.g * -0.331 + rgb.b *  0.5    + 0.5,\n        rgb.r *  0.5   + rgb.g * -0.419 + rgb.b * -0.081  + 0.5\n    );\n}\n\nvoid main(void) {\n    gl_FragColor = texture2D(map, vUv);\n\n    if (keying) {\n        float chromaDist = distance(RGBtoUV(gl_FragColor.rgb), RGBtoUV(color));\n\n        float baseMask = chromaDist - similarity;\n        float fullMask = pow(clamp(baseMask / smoothness, 0., 1.), 1.5);\n        gl_FragColor.a *= fullMask * alpha;\n\n        float spillVal = pow(clamp(baseMask / spill, 0., 1.), 1.5);\n        float desat = clamp(gl_FragColor.r * 0.2126 + gl_FragColor.g * 0.7152 + gl_FragColor.b * 0.0722, 0., 1.);\n        gl_FragColor.rgb = mix(vec3(desat, desat, desat), gl_FragColor.rgb, spillVal);\n    } else {\n        gl_FragColor.a *= alpha;\n    }\n}\n"}),this.chromaKey=e?.chromaKey}};function Q(e){return e.reduce((e,t)=>e.add(t),new r.Pq0).normalize()}var J=new r.Pq0,ee=new r.Pq0,et=new r.Pq0,ei=new r.Pq0,es=new r.Pq0,er=new r.Pq0,en=class extends Y{get threeElement(){return this.element}get threeMesh(){return this.threeElement.children[0]}get video(){return"videoLayer"===this.type?this.threeMesh.material.map.image:null}constructor(e,t,i){super(e,t,i)}is3d(){return!0}createElement(){let e=new G({alpha:0}),t=new r.bdM(1,1),i=new r.eaF(t,e);i.userData={[T]:this},Object.defineProperty(i,"visible",{enumerable:!0,get:function(){return this.userData[T].config.visible},set:function(e){this.userData[T].config.visible=e}}),this.element=new r.YJl().add(i),"videoLayer"===this.type&&this.viewer.needsContinuousUpdate(!0)}destroy(){delete this.threeMesh.userData[T],"videoLayer"===this.type&&(this.video.pause(),this.viewer.needsContinuousUpdate(!1)),super.destroy()}render(){return this.viewer.renderer.isObjectVisible(this.threeMesh)?this.viewer.dataHelper.sphericalCoordsToViewerCoords(this.state.position):null}update(e){super.update(e);let t=this.threeMesh,i=t.parent,n=t.material;if(s.Wp.isExtendedPosition(this.config.position)){try{this.state.position=this.viewer.dataHelper.cleanPosition(this.config.position)}catch(e){throw new s.e6(`invalid marker ${this.id} position`,e)}if(!this.config.size)throw new s.e6(`missing marker ${this.id} size`);this.state.size=this.config.size,t.scale.set(this.config.size.width/100,this.config.size.height/100,1),t.position.set(t.scale.x*(.5-this.state.anchor.x),t.scale.y*(this.state.anchor.y-.5),0),t.rotation.set(0,0,0),this.viewer.dataHelper.sphericalCoordsToVector3(this.state.position,i.position),i.lookAt(0,i.position.y,0),t.rotateY(-this.config.rotation.yaw),t.rotateX(-this.config.rotation.pitch),t.rotateZ(-this.config.rotation.roll);let e=t.geometry.getAttribute("position");this.state.positions3D=[0,1,3,2].map(i=>{let s=new r.Pq0;return s.fromBufferAttribute(e,i),t.localToWorld(s)})}else{let e;if(this.config.position?.length!==4)throw new s.e6(`missing marker ${this.id} position`);try{e=this.config.position.map(e=>this.viewer.dataHelper.cleanPosition(e))}catch(e){throw new s.e6(`invalid marker ${this.id} position`,e)}let i=e.map(e=>this.viewer.dataHelper.sphericalCoordsToVector3(e)),r=Q(i);this.state.position=this.viewer.dataHelper.vector3ToSphericalCoords(r),this.state.positions3D=i;let o=t.geometry.getAttribute("position");[i[0],i[1],i[3],i[2]].forEach((e,t)=>{o.setX(t,e.x),o.setY(t,e.y),o.setZ(t,e.z)}),o.needsUpdate=!0,this.__setTextureWrap(n)}switch(this.type){case"videoLayer":if(this.definition!==this.config.videoLayer){n.map?.dispose();let e=function({src:e,withCredentials:t,muted:i,autoplay:s}){let r=document.createElement("video");return r.crossOrigin=t?"use-credentials":"anonymous",r.loop=!0,r.playsInline=!0,r.autoplay=s,r.muted=i,r.preload="metadata",e instanceof MediaStream?r.srcObject=e:r.src=e,r}({src:this.config.videoLayer,withCredentials:this.viewer.config.withCredentials(this.config.videoLayer),muted:!0,autoplay:this.config.autoplay??!0});n.map=new r.Nv2(e),n.alpha=0,e.addEventListener("loadedmetadata",()=>{this.viewer&&(n.alpha=this.config.opacity,s.Wp.isExtendedPosition(this.config.position)||(t.material.userData[T]={width:e.videoWidth,height:e.videoHeight},this.__setTextureWrap(n)))},{once:!0}),e.autoplay&&e.play(),this.definition=this.config.videoLayer}else n.alpha=this.config.opacity;break;case"imageLayer":if(this.definition!==this.config.imageLayer){n.map?.dispose();let e=new r.gPd;n.map=e,n.alpha=0,this.viewer.textureLoader.loadImage(this.config.imageLayer).then(i=>{this.viewer&&(s.Wp.isExtendedPosition(this.config.position)||(t.material.userData[T]={width:i.width,height:i.height},this.__setTextureWrap(n)),e.image=i,e.anisotropy=4,e.needsUpdate=!0,n.alpha=this.config.opacity,this.viewer.needsUpdate())}),this.definition=this.config.imageLayer}else n.alpha=this.config.opacity}n.chromaKey=this.config.chromaKey,t.renderOrder=1e3+this.config.zIndex,t.geometry.boundingBox=null}__setTextureWrap(e){let t=e.userData[T];if(!t||!t.height||!t.width){e.repeat.set(1,1),e.offset.set(0,0);return}let i=this.config.position.map(e=>this.viewer.dataHelper.cleanPosition(e)),r=s.Wp.greatArcDistance([i[0].yaw,i[0].pitch],[i[1].yaw,i[1].pitch]),n=s.Wp.greatArcDistance([i[3].yaw,i[3].pitch],[i[2].yaw,i[2].pitch]),o=(r+n)/(s.Wp.greatArcDistance([i[1].yaw,i[1].pitch],[i[2].yaw,i[2].pitch])+s.Wp.greatArcDistance([i[0].yaw,i[0].pitch],[i[3].yaw,i[3].pitch])),a=t.width/t.height,l=0,h=0;o<a?l=a-o:h=1/a-1/o,e.repeat.set(1-l,1-h),e.offset.set(l/2,h/2)}},eo=class extends K{constructor(e,t,i){super(e,t,i),this.viewportIntersection=!1}get threeElement(){return this.object}isCss3d(){return!0}createElement(){this.element=document.createElement("div"),this.object=new H(this.element),this.object.userData={[T]:this},Object.defineProperty(this.object,"visible",{enumerable:!0,get:function(){return this.userData[T].config.visible},set:function(e){this.userData[T].config.visible=e}}),this.afterCreateElement()}destroy(){delete this.object.userData[T],delete this.object,super.destroy()}render({viewerPosition:e,zoomLevel:t}){let i=this.domElement;if(this.state.size={width:i.offsetWidth,height:i.offsetHeight},!(this.state.positions3D[0].dot(this.viewer.state.direction)>0&&this.viewportIntersection))return null;{let i=this.viewer.dataHelper.sphericalCoordsToViewerCoords(this.state.position);return this.config.elementLayer.updateMarker?.({marker:this,position:i,viewerPosition:e,zoomLevel:t,viewerSize:this.viewer.state.size}),i}}update(e){if(super.update(e),!s.Wp.isExtendedPosition(this.config.position))throw new s.e6(`missing marker ${this.id} position`);try{this.state.position=this.viewer.dataHelper.cleanPosition(this.config.position)}catch(e){throw new s.e6(`invalid marker ${this.id} position`,e)}this.state.positions3D=[this.viewer.dataHelper.sphericalCoordsToVector3(this.state.position)];let t=this.threeElement,i=this.domElement;i.classList.add("psv-marker--css3d"),i.childNodes.forEach(e=>e.remove()),i.appendChild(this.config.elementLayer),this.config.elementLayer.style.display="block",t.position.copy(this.state.positions3D[0]).multiplyScalar(100),t.lookAt(0,100*this.state.positions3D[0].y,0),t.rotateY(-this.config.rotation.yaw),t.rotateX(-this.config.rotation.pitch),t.rotateZ(-this.config.rotation.roll)}},ea=class extends X{constructor(e,t,i){super(e,t,i)}isNormal(){return!0}createElement(){this.element=document.createElement("div"),this.afterCreateElement()}render(e){let t=super.render(e);return t&&"element"===this.type&&this.config.element.updateMarker?.({marker:this,position:t,viewerPosition:e.viewerPosition,zoomLevel:e.zoomLevel,viewerSize:this.viewer.state.size}),t}update(e){super.update(e);let t=this.domElement;if(this.config.image&&!this.config.size)throw new s.e6(`missing marker ${this.id} size`);switch(this.config.size?(this.needsUpdateSize=!1,this.state.size=this.config.size,t.style.width=this.config.size.width+"px",t.style.height=this.config.size.height+"px"):this.needsUpdateSize=!0,this.type){case"image":this.definition=this.config.image,t.style.backgroundImage=`url("${this.config.image}")`;break;case"html":this.definition=this.config.html,t.innerHTML=this.config.html;break;case"element":this.definition!==this.config.element&&(this.definition=this.config.element,t.childNodes.forEach(e=>e.remove()),t.appendChild(this.config.element),this.config.element.style.display="block")}}},el=class extends K{constructor(e,t,i){super(e,t,i)}createElement(){this.element=document.createElementNS(L,"path"),this.element[T]=this}isPoly(){return!0}get isPixels(){return"polygonPixels"===this.type||"polylinePixels"===this.type}get isPolygon(){return"polygon"===this.type||"polygonPixels"===this.type}get isPolyline(){return"polyline"===this.type||"polylinePixels"===this.type}get coords(){return this.definition}render(){let e=this.__getAllPolyPositions();if(!(e[0].length>(this.isPolygon?2:1)))return null;{let t=this.viewer.dataHelper.sphericalCoordsToViewerCoords(this.state.position),i=e.filter(e=>e.length>0).map(e=>{let i="M";return i+=e.map(e=>`${e.x-t.x},${e.y-t.y}`).join("L"),this.isPolygon&&(i+="Z"),i}).join(" ");return this.domElement.setAttributeNS(null,"d",i),this.domElement.setAttributeNS(null,"transform",`translate(${t.x} ${t.y})`),t}}update(e){super.update(e);let t=this.domElement;t.classList.add("psv-marker--poly"),this.config.svgStyle?(Object.entries(this.config.svgStyle).forEach(([e,i])=>{t.setAttributeNS(null,s.Wp.dasherize(e),i)}),this.isPolyline&&!this.config.svgStyle.fill&&t.setAttributeNS(null,"fill","none")):this.isPolygon?t.setAttributeNS(null,"fill","rgba(0,0,0,0.5)"):this.isPolyline&&(t.setAttributeNS(null,"fill","none"),t.setAttributeNS(null,"stroke","rgb(0,0,0)"));try{let e=this.config[this.type];if(!Array.isArray(e[0])&&"object"!=typeof e[0])for(let t=0;t<e.length;t++)e.splice(t,2,[e[t],e[t+1]]);if(Array.isArray(e[0][0])||"object"==typeof e[0][0]||(e=[e]),this.isPolyline&&e.length>1)throw new s.e6("polylines cannot have holes");this.isPixels?this.definition=e.map(e=>e.map(e=>{let t;return[(t=s.Wp.isExtendedPosition(e)?this.viewer.dataHelper.cleanPosition(e):this.viewer.dataHelper.textureCoordsToSphericalCoords({textureX:e[0],textureY:e[1]})).yaw,t.pitch]})):this.definition=e.map(e=>e.map(e=>{let t;return[(t=s.Wp.isExtendedPosition(e)?this.viewer.dataHelper.cleanPosition(e):this.viewer.dataHelper.cleanPosition({yaw:e[0],pitch:e[1]})).yaw,t.pitch]}))}catch(e){throw new s.e6(`invalid marker ${this.id} position`,e)}if(this.positions3D=this.coords.map(e=>e.map(e=>this.viewer.dataHelper.sphericalCoordsToVector3({yaw:e[0],pitch:e[1]}))),this.isPolygon){let e=Q(this.positions3D[0]);this.state.position=this.viewer.dataHelper.vector3ToSphericalCoords(e)}else{let e=function(e){let t=function(e){let t=[e[0]],i=0;for(let s=1;s<e.length;s++){let r=e[s-1][0]-e[s][0];r>Math.PI?i+=1:r<-Math.PI&&(i-=1),t.push([e[s][0]+2*i*Math.PI,e[s][1]])}return t}(e),i=0,r=[];for(let e=0;e<t.length-1;e++){let n=s.Wp.greatArcDistance(t[e],t[e+1])*s.aH.SPHERE_RADIUS;r.push(n),i+=n}let n=0;for(let e=0;e<t.length-1;e++){if(n+r[e]>i/2){let o=(i/2-n)/r[e];return function(e,t,i){let[r,n]=e,[o,a]=t,l=s.Wp.greatArcDistance(e,t),h=Math.sin((1-i)*l)/Math.sin(l),c=Math.sin(i*l)/Math.sin(l),p=h*Math.cos(n)*Math.cos(r)+c*Math.cos(a)*Math.cos(o),d=h*Math.cos(n)*Math.sin(r)+c*Math.cos(a)*Math.sin(o);return[Math.atan2(d,p),Math.atan2(h*Math.sin(n)+c*Math.sin(a),Math.sqrt(p*p+d*d))]}(t[e],t[e+1],o)}n+=r[e]}return t[Math.round(t.length/2)]}(this.coords[0]);this.state.position={yaw:e[0],pitch:e[1]}}this.state.positions3D=this.positions3D[0]}__getAllPolyPositions(){return this.positions3D.map(e=>this.__getPolyPositions(e))}__getPolyPositions(e){let t=e.length,i=e.map(e=>({vector:e,visible:e.dot(this.viewer.state.direction)>0})),n=[];return i.forEach((e,s)=>{e.visible||[0===s?i[t-1]:i[s-1],s===t-1?i[0]:i[s+1]].forEach(t=>{t.visible&&n.push({visible:t.vector,invisible:e.vector,index:s})})}),n.reverse().forEach(e=>{i.splice(e.index,0,{vector:function(e,t,i){J.copy(i).normalize(),ee.crossVectors(e,t).normalize(),et.crossVectors(ee,e).normalize(),ei.copy(e).multiplyScalar(-J.dot(et)),es.copy(et).multiplyScalar(J.dot(e));let n=new r.Pq0().addVectors(ei,es).normalize();return er.crossVectors(n,J),n.applyAxisAngle(er,.01).multiplyScalar(s.aH.SPHERE_RADIUS)}(e.visible,e.invisible,this.viewer.state.direction),visible:!0})}),i.filter(e=>e.visible).map(e=>this.viewer.dataHelper.vector3ToViewerCoords(e.vector))}},eh=class extends X{get svgElement(){return this.domElement.firstElementChild}constructor(e,t,i){super(e,t,i)}isSvg(){return!0}createElement(){let e="square"===this.type?"rect":this.type,t=document.createElementNS(L,e);this.element=document.createElementNS(L,"svg"),this.element.appendChild(t),this.afterCreateElement()}update(e){super.update(e);let t=this.svgElement;switch(this.needsUpdateSize=!0,this.type){case"square":this.definition={x:0,y:0,width:this.config.square,height:this.config.square};break;case"rect":Array.isArray(this.config.rect)?this.definition={x:0,y:0,width:this.config.rect[0],height:this.config.rect[1]}:this.definition={x:0,y:0,width:this.config.rect.width,height:this.config.rect.height};break;case"circle":this.definition={cx:this.config.circle,cy:this.config.circle,r:this.config.circle};break;case"ellipse":Array.isArray(this.config.ellipse)?this.definition={cx:this.config.ellipse[0],cy:this.config.ellipse[1],rx:this.config.ellipse[0],ry:this.config.ellipse[1]}:this.definition={cx:this.config.ellipse.rx,cy:this.config.ellipse.ry,rx:this.config.ellipse.rx,ry:this.config.ellipse.ry};break;case"path":this.definition={d:this.config.path}}Object.entries(this.definition).forEach(([e,i])=>{t.setAttributeNS(null,e,i)}),this.config.svgStyle?Object.entries(this.config.svgStyle).forEach(([e,i])=>{t.setAttributeNS(null,s.Wp.dasherize(e),i)}):t.setAttributeNS(null,"fill","rgba(0,0,0,0.5)")}},ec=s.Wp.getConfigParser({clickEventOnMarker:!1,gotoMarkerSpeed:"8rpm",markers:null,defaultHoverScale:null},{defaultHoverScale:e=>e?(!0===e&&(e=D),"number"==typeof e&&(e={amount:e}),{...D,...e}):null}),ep=class e extends s.TL{constructor(e,t){super(e,t),this.markers={},this.state={allVisible:!0,showAllTooltips:!1,currentMarker:null,hoveringMarker:null,needsReRender:!1,lastClientX:null,lastClientY:null},this.container=document.createElement("div"),this.container.className="psv-markers",this.viewer.container.appendChild(this.container),this.container.addEventListener("contextmenu",e=>e.preventDefault()),this.svgContainer=document.createElementNS(L,"svg"),this.svgContainer.setAttribute("class","psv-markers-svg-container"),this.container.appendChild(this.svgContainer),this.css3DContainer=new U(e),this.container.appendChild(this.css3DContainer.element),this.container.addEventListener("mouseenter",this,!0),this.container.addEventListener("mouseleave",this,!0),this.container.addEventListener("mousemove",this,!0)}static withConfig(t){return[e,t]}init(){super.init(),s.Wp.checkStylesheet(this.viewer.container,"markers-plugin"),this.viewer.addEventListener(s.AZ.ClickEvent.type,this),this.viewer.addEventListener(s.AZ.DoubleClickEvent.type,this),this.viewer.addEventListener(s.AZ.RenderEvent.type,this),this.viewer.addEventListener(s.AZ.ConfigChangedEvent.type,this),this.viewer.addEventListener(s.AZ.ObjectEnterEvent.type,this),this.viewer.addEventListener(s.AZ.ObjectHoverEvent.type,this),this.viewer.addEventListener(s.AZ.ObjectLeaveEvent.type,this),this.viewer.addEventListener(s.AZ.ReadyEvent.type,this,{once:!0})}destroy(){this.clearMarkers(!1),this.viewer.unobserveObjects(T),this.viewer.removeEventListener(s.AZ.ClickEvent.type,this),this.viewer.removeEventListener(s.AZ.DoubleClickEvent.type,this),this.viewer.removeEventListener(s.AZ.RenderEvent.type,this),this.viewer.removeEventListener(s.AZ.ObjectEnterEvent.type,this),this.viewer.removeEventListener(s.AZ.ObjectHoverEvent.type,this),this.viewer.removeEventListener(s.AZ.ObjectLeaveEvent.type,this),this.viewer.removeEventListener(s.AZ.ReadyEvent.type,this),this.css3DContainer.destroy(),this.viewer.container.removeChild(this.container),super.destroy()}handleEvent(e){switch(e.type){case s.AZ.ReadyEvent.type:this.config.markers&&(this.setMarkers(this.config.markers),delete this.config.markers);break;case s.AZ.RenderEvent.type:this.renderMarkers();break;case s.AZ.ClickEvent.type:this.__onClick(e,!1);break;case s.AZ.DoubleClickEvent.type:this.__onClick(e,!0);break;case s.AZ.ObjectEnterEvent.type:case s.AZ.ObjectLeaveEvent.type:case s.AZ.ObjectHoverEvent.type:if(e.userDataKey===T){let t=e.originalEvent,i=e.object.userData[T];switch(e.type){case s.AZ.ObjectEnterEvent.type:i.config.style?.cursor?this.viewer.setCursor(i.config.style.cursor):(i.config.tooltip||i.config.content)&&this.viewer.setCursor("pointer"),this.__onEnterMarker(t,i);break;case s.AZ.ObjectLeaveEvent.type:this.viewer.setCursor(null),this.__onLeaveMarker(i);break;case s.AZ.ObjectHoverEvent.type:this.__onHoverMarker(t,i)}}break;case"mouseenter":{let t=this.__getTargetMarker(s.Wp.getEventTarget(e));this.__onEnterMarker(e,t);break}case"mouseleave":{let t=this.__getTargetMarker(s.Wp.getEventTarget(e));this.__onLeaveMarker(t);break}case"mousemove":{let t=this.__getTargetMarker(s.Wp.getEventTarget(e),!0);this.__onHoverMarker(e,t)}}}toggleAllMarkers(){this.state.allVisible?this.hideAllMarkers():this.showAllMarkers()}showAllMarkers(){this.state.allVisible=!0,Object.values(this.markers).forEach(e=>{e.config.visible=!0}),this.renderMarkers(),this.dispatchEvent(new x)}hideAllMarkers(){this.state.allVisible=!1,Object.values(this.markers).forEach(e=>{e.config.visible=!1}),this.renderMarkers(),this.dispatchEvent(new E)}toggleAllTooltips(){this.state.showAllTooltips?this.hideAllTooltips():this.showAllTooltips()}showAllTooltips(){this.state.showAllTooltips=!0,Object.values(this.markers).forEach(e=>{e.state.staticTooltip=!0,e.showTooltip()})}hideAllTooltips(){this.state.showAllTooltips=!1,Object.values(this.markers).forEach(e=>{e.state.staticTooltip=!1,e.hideTooltip()})}getNbMarkers(){return Object.keys(this.markers).length}getMarkers(){return Object.values(this.markers)}addMarker(e,t=!0){if(this.markers[e.id])throw new s.e6(`marker "${e.id}" already exists`);let i=new(function(e){switch(B(e,!1)){case"image":case"html":case"element":return ea;case"imageLayer":case"videoLayer":return en;case"elementLayer":return eo;case"polygon":case"polyline":case"polygonPixels":case"polylinePixels":return el;case"square":case"rect":case"circle":case"ellipse":case"path":return eh;default:throw new s.e6("invalid marker type")}}(e))(this.viewer,this,e);i.isPoly()?this.svgContainer.appendChild(i.domElement):i.isCss3d()?this.css3DContainer.addObject(i):i.is3d()?this.viewer.renderer.addObject(i.threeElement):this.container.appendChild(i.domElement),this.markers[i.id]=i,this.state.showAllTooltips&&(i.state.staticTooltip=!0),t&&this.__afterChangeMarkers()}getMarker(e){let t="object"==typeof e?e.id:e;if(!this.markers[t])throw new s.e6(`cannot find marker "${t}"`);return this.markers[t]}getCurrentMarker(){return this.state.currentMarker}updateMarker(e,t=!0){let i=this.getMarker(e.id);i.update(e),t&&(this.__afterChangeMarkers(),(i===this.state.hoveringMarker&&i.config.tooltip?.trigger==="hover"||i.state.staticTooltip)&&i.showTooltip(this.state.lastClientX,this.state.lastClientY,!0))}removeMarker(e,t=!0){let i=this.getMarker(e);i.isPoly()?this.svgContainer.removeChild(i.domElement):i.isCss3d()?this.css3DContainer.removeObject(i):i.is3d()?this.viewer.renderer.removeObject(i.threeElement):this.container.removeChild(i.domElement),this.state.hoveringMarker===i&&(this.state.hoveringMarker=null),this.state.currentMarker===i&&(this.state.currentMarker=null),i.destroy(),delete this.markers[i.id],t&&this.__afterChangeMarkers()}removeMarkers(e,t=!0){e.forEach(e=>this.removeMarker(e,!1)),t&&this.__afterChangeMarkers()}setMarkers(e,t=!0){this.clearMarkers(!1),e?.forEach(e=>{this.addMarker(e,!1)}),t&&this.__afterChangeMarkers()}clearMarkers(e=!0){Object.keys(this.markers).forEach(e=>{this.removeMarker(e,!1)}),e&&this.__afterChangeMarkers()}gotoMarker(e,t=this.config.gotoMarkerSpeed){let i=this.getMarker(e);return t?this.viewer.animate({...i.state.position,zoom:i.config.zoomLvl,speed:t}).then(()=>{this.dispatchEvent(new c(i))}):(this.viewer.rotate(i.state.position),s.Wp.isNil(i.config.zoomLvl)||this.viewer.zoom(i.config.zoomLvl),this.dispatchEvent(new c(i)),Promise.resolve())}hideMarker(e){this.toggleMarker(e,!1)}showMarker(e){this.toggleMarker(e,!0)}showMarkerTooltip(e){let t=this.getMarker(e);t.state.staticTooltip=!0,t.showTooltip()}hideMarkerTooltip(e){let t=this.getMarker(e);t.state.staticTooltip=!1,t.hideTooltip()}toggleMarker(e,t){let i=this.getMarker(e);i.config.visible=s.Wp.isNil(t)?!i.config.visible:t,this.renderMarkers()}showMarkerPanel(e){let t=this.getMarker(e);t.config.content?this.viewer.panel.show({id:O,content:t.config.content}):this.hideMarkerPanel()}hideMarkerPanel(){this.viewer.panel.hide(O)}toggleMarkersList(){this.viewer.panel.isVisible(R)?this.hideMarkersList():this.showMarkersList()}showMarkersList(){let e,t,i=[];Object.values(this.markers).forEach(e=>{e.config.visible&&!e.config.hideList&&i.push(e)});let r=new A(i);this.dispatchEvent(r),i=r.markers,this.viewer.panel.show({id:R,content:(e=i,t=this.viewer.config.lang[P.id],`
<div class="psv-panel-menu psv-panel-menu--stripped">
    <h1 class="psv-panel-menu-title">${z} ${t}</h1>
    <ul class="psv-panel-menu-list">
    ${e.map(e=>`
        <li data-${j}="${e.id}" class="psv-panel-menu-item" tabindex="0">
          ${"image"===e.type?`<span class="psv-panel-menu-item-icon"><img src="${e.definition}"/></span>`:""}
          <span class="psv-panel-menu-item-label">${e.getListContent()}</span>
        </li>
    `).join("")}
    </ul>
</div>
`),noMargin:!0,clickHandler:e=>{let t=s.Wp.getClosest(e,".psv-panel-menu-item"),i=t?t.dataset[T]:void 0;if(i){let e=this.getMarker(i);this.dispatchEvent(new y(e)),this.gotoMarker(e.id),this.hideMarkersList()}}})}hideMarkersList(){this.viewer.panel.hide(R)}renderMarkers(){if(this.state.needsReRender){this.state.needsReRender=!1;return}let e=this.viewer.getZoomLevel(),t=this.viewer.getPosition(),i=this.state.hoveringMarker;Object.values(this.markers).forEach(r=>{let n=r.config.visible,o=!1,a=null;n&&(n=!!(a=r.render({viewerPosition:t,zoomLevel:e,hoveringMarker:i}))),o=r.state.visible!==n,r.state.visible=n,r.state.position2D=a,r.domElement&&s.Wp.toggleClass(r.domElement,"psv-marker--visible",n),n?r.state.staticTooltip?r.showTooltip():r!==this.state.hoveringMarker&&r.hideTooltip():r.hideTooltip(),o&&(this.dispatchEvent(new l(r,n)),(r.is3d()||r.isCss3d())&&(this.state.needsReRender=!0))}),this.state.needsReRender&&this.viewer.needsUpdate()}__getTargetMarker(e,t=!1){if(e instanceof Node){let i=t?s.Wp.getClosest(e,".psv-marker"):e;return i?i[T]:void 0}return Array.isArray(e)?e.map(e=>e.userData[T]).filter(e=>!!e).sort((e,t)=>t.config.zIndex-e.config.zIndex)[0]:null}__onEnterMarker(e,t){t&&(this.state.hoveringMarker=t,this.state.lastClientX=e.clientX,this.state.lastClientY=e.clientY,this.dispatchEvent(new v(t)),t instanceof X&&t.applyScale({zoomLevel:this.viewer.getZoomLevel(),viewerPosition:this.viewer.getPosition(),mouseover:!0}),t.state.staticTooltip||t.config.tooltip?.trigger!=="hover"||t.showTooltip(e.clientX,e.clientY))}__onLeaveMarker(e){e&&(this.dispatchEvent(new d(e)),e instanceof X&&e.applyScale({zoomLevel:this.viewer.getZoomLevel(),viewerPosition:this.viewer.getPosition(),mouseover:!1}),this.state.hoveringMarker=null,e.state.staticTooltip||e.config.tooltip?.trigger!=="hover"?e.state.staticTooltip&&e.showTooltip():e.hideTooltip())}__onHoverMarker(e,t){t&&(this.state.lastClientX=e.clientX,this.state.lastClientY=e.clientY,(t.isPoly()||t.is3d()||t.isCss3d())&&t.config.tooltip?.trigger==="hover"&&t.showTooltip(e.clientX,e.clientY))}__onClick(e,t){let i=this.__getTargetMarker(e.data.objects),s=this.__getTargetMarker(e.data.target,!0)||i;this.state.currentMarker&&this.state.currentMarker!==s&&(this.dispatchEvent(new k(this.state.currentMarker)),this.viewer.panel.hide(O),this.state.showAllTooltips||this.state.currentMarker.config.tooltip?.trigger!=="click"||this.hideMarkerTooltip(this.state.currentMarker.id),this.state.currentMarker=null),s&&(this.state.currentMarker=s,this.dispatchEvent(new m(s,t,e.data.rightclick)),this.config.clickEventOnMarker?e.data.marker=s:e.stopImmediatePropagation(),this.markers[s.id]&&!e.data.rightclick&&(s.config.tooltip?.trigger==="click"?s.tooltip?this.hideMarkerTooltip(s.id):this.showMarkerTooltip(s.id):this.showMarkerPanel(s.id)))}__afterChangeMarkers(){this.__refreshUi(),this.__checkObjectsObserver(),this.viewer.needsUpdate(),this.dispatchEvent(new S(this.getMarkers()))}__refreshUi(){let e=Object.values(this.markers).filter(e=>!e.config.hideList).length;0===e?(this.viewer.panel.hide(O),this.viewer.panel.hide(R)):this.viewer.panel.isVisible(R)?this.showMarkersList():this.viewer.panel.isVisible(O)&&(this.state.currentMarker?this.showMarkerPanel(this.state.currentMarker.id):this.viewer.panel.hide()),this.viewer.navbar.getButton(P.id,!1)?.toggle(e>0),this.viewer.navbar.getButton(W.id,!1)?.toggle(e>0)}__checkObjectsObserver(){Object.values(this.markers).some(e=>e.is3d())?this.viewer.observeObjects(T):this.viewer.unobserveObjects(T)}};ep.id="markers",ep.VERSION="5.14.0",ep.configParser=ec,ep.readonlyOptions=["markers"];var ed=ep;s.zY.lang[P.id]="Markers",s.zY.lang[W.id]="Markers list",(0,s.S)(P,"caption:left"),(0,s.S)(W,"caption:left")},71691:(e,t,i)=>{"use strict";i.d(t,{Q:()=>d});var s=i(12690),r=i(85339),n=Object.defineProperty;((e,t)=>{for(var i in t)n(e,i,{get:t[i],enumerable:!0})})({},{AutorotateEvent:()=>a});var o=class e extends s.rx{constructor(t){super(e.type),this.autorotateEnabled=t}};o.type="autorotate";var a=o,l=class extends s.Np{constructor(e){super(e,{className:"psv-autorotate-button",hoverScale:!0,collapsable:!0,tabbable:!0,icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 41 41" overflow="visible"><g fill="currentColor" transform-origin="center" transform="scale(1.3)"><path d="M40.5 14.1c-.1-.1-1.2-.5-2.899-1-.101 0-.2-.1-.2-.2C34.5 6.5 28 2 20.5 2S6.6 6.5 3.7 12.9c0 .1-.1.1-.2.2-1.7.6-2.8 1-2.9 1l-.6.3v12.1l.6.2c.1 0 1.1.4 2.7.9.1 0 .2.1.2.199C6.3 34.4 12.9 39 20.5 39c7.601 0 14.101-4.6 16.9-11.1 0-.101.1-.101.2-.2 1.699-.6 2.699-1 2.8-1l.6-.3V14.3l-.5-.2zM20.5 4c5.8 0 10.9 3 13.8 7.5.2.3-.1.6-.399.5-3.8-1-8.8-2-13.6-2-4.7 0-9.5 1-13.2 2-.3.1-.5-.2-.4-.5C9.7 7 14.8 4 20.5 4zm0 33c-5.9 0-11.1-3.1-14-7.899-.2-.301.1-.601.4-.5 3.9 1 8.9 2.1 13.6 2.1 5 0 9.9-1 13.601-2 .3-.1.5.2.399.5A16.422 16.422 0 0 1 20.5 37zm18.601-12.1c0 .1-.101.3-.2.3-2.5.9-10.4 3.6-18.4 3.6-7.1 0-15.6-2.699-18.3-3.6C2.1 25.2 2 25 2 24.9V16c0-.1.1-.3.2-.3 2.6-.9 10.6-3.6 18.2-3.6 7.5 0 15.899 2.7 18.5 3.6.1 0 .2.2.2.3v8.9z"/><path d="M18.7 24l6.4-3.7c.3-.2.3-.7 0-.8l-6.4-3.8c-.3-.2-.7 0-.7.4v7.4c0 .5.4.7.7.5z"/></g>\x3c!--Created by Nick Bluth from the Noun Project--\x3e</svg>\n',iconActive:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 41 41" overflow="visible"><g fill="currentColor" transform-origin="center" transform="scale(1.3)"><path d="M40.5 14.1c-.1-.1-1.2-.5-2.898-1-.102 0-.202-.1-.202-.2C34.5 6.5 28 2 20.5 2S6.6 6.5 3.7 12.9c0 .1-.1.1-.2.2-1.7.6-2.8 1-2.9 1l-.6.3v12.1l.6.2c.1 0 1.1.399 2.7.899.1 0 .2.101.2.199C6.3 34.4 12.9 39 20.5 39c7.602 0 14.102-4.6 16.9-11.1 0-.102.1-.102.199-.2 1.699-.601 2.699-1 2.801-1l.6-.3V14.3l-.5-.2zM6.701 11.5C9.7 7 14.8 4 20.5 4c5.8 0 10.9 3 13.8 7.5.2.3-.1.6-.399.5-3.799-1-8.799-2-13.6-2-4.7 0-9.5 1-13.2 2-.3.1-.5-.2-.4-.5zM25.1 20.3L18.7 24c-.3.2-.7 0-.7-.5v-7.4c0-.4.4-.6.7-.4l6.399 3.8c.301.1.301.6.001.8zm9.4 8.901A16.421 16.421 0 0 1 20.5 37c-5.9 0-11.1-3.1-14-7.898-.2-.302.1-.602.4-.5 3.9 1 8.9 2.1 13.6 2.1 5 0 9.9-1 13.602-2 .298-.1.5.198.398.499z"/></g>\x3c!--Created by Nick Bluth from the Noun Project--\x3e</svg>\n'}),this.plugin=this.viewer.getPlugin("autorotate"),this.plugin?.addEventListener(a.type,this)}destroy(){this.plugin?.removeEventListener(a.type,this),super.destroy()}isSupported(){return!!this.plugin}handleEvent(e){e instanceof a&&this.toggleActive(e.autorotateEnabled)}onClick(){this.plugin.isEnabled()&&this.plugin.disableOnIdle(),this.plugin.toggle()}};l.id="autorotate";var h=s.Wp.getConfigParser({autostartDelay:2e3,autostartOnIdle:!0,autorotateSpeed:s.Wp.parseSpeed("2rpm"),autorotatePitch:null,autorotateZoomLvl:null,keypoints:null,startFromClosest:!0},{autostartOnIdle:(e,{rawConfig:t})=>e&&s.Wp.isNil(t.autostartDelay)?(s.Wp.logWarn("autostartOnIdle requires a non null autostartDelay"),!1):e,autorotateSpeed:e=>s.Wp.parseSpeed(e),autorotatePitch:e=>s.Wp.isNil(e)?null:s.Wp.parseAngle(e,!0),autorotateZoomLvl:e=>s.Wp.isNil(e)?null:r.cj9.clamp(e,0,100)});function c(e){return[e.yaw,e.pitch]}var p=class e extends s.TL{constructor(e,t){super(e,t),this.state={initialStart:!0,disableOnIdle:!1,enabled:!1,idx:-1,curve:[],startStep:null,endStep:null,startTime:null,stepDuration:null,remainingPause:null,lastTime:null,tooltip:null},this.state.initialStart=!s.Wp.isNil(this.config.autostartDelay)}static withConfig(t){return[e,t]}init(){super.init(),this.video=this.viewer.getPlugin("video"),this.markers=this.viewer.getPlugin("markers"),this.config.keypoints&&(this.setKeypoints(this.config.keypoints),delete this.config.keypoints),this.viewer.addEventListener(s.AZ.StopAllEvent.type,this),this.viewer.addEventListener(s.AZ.BeforeRenderEvent.type,this),this.video||this.viewer.addEventListener(s.AZ.KeypressEvent.type,this)}destroy(){this.viewer.removeEventListener(s.AZ.StopAllEvent.type,this),this.viewer.removeEventListener(s.AZ.BeforeRenderEvent.type,this),this.viewer.removeEventListener(s.AZ.KeypressEvent.type,this),delete this.video,delete this.markers,delete this.keypoints,super.destroy()}handleEvent(e){switch(e.type){case s.AZ.StopAllEvent.type:this.stop();break;case s.AZ.BeforeRenderEvent.type:this.__beforeRender(e.timestamp);break;case s.AZ.KeypressEvent.type:this.__onKeyPress(e)}}setKeypoints(e){if(e){if(e.length<2)throw new s.e6("At least two points are required");this.keypoints=e.map((e,t)=>{let i,r={position:null,markerId:null,pause:0,tooltip:null};if("string"==typeof e?r.markerId=e:s.Wp.isExtendedPosition(e)?i=e:(r.markerId=e.markerId,r.pause=e.pause,i=e.position,e.tooltip&&"object"==typeof e.tooltip?r.tooltip=e.tooltip:"string"==typeof e.tooltip&&(r.tooltip={content:e.tooltip})),r.markerId){if(!this.markers)throw new s.e6(`Keypoint #${t} references a marker but the markers plugin is not loaded`);let e=this.markers.getMarker(r.markerId);r.position=c(e.state.position)}else if(i)r.position=c(this.viewer.dataHelper.cleanPosition(i));else throw new s.e6(`Keypoint #${t} is missing marker or position`);return r})}else this.keypoints=null;this.isEnabled()&&(this.stop(),this.start())}isEnabled(){return this.state.enabled}start(){this.isEnabled()||(this.viewer.stopAll(),this.keypoints?this.config.startFromClosest&&this.__shiftKeypoints():this.__animate(),this.state.initialStart=!1,this.state.disableOnIdle=!1,this.state.enabled=!0,this.dispatchEvent(new a(!0)))}stop(){this.isEnabled()&&(this.__hideTooltip(),this.__reset(),this.viewer.stopAnimation(),this.viewer.dynamics.position.stop(),this.viewer.dynamics.zoom.stop(),this.state.enabled=!1,this.dispatchEvent(new a(!1)))}toggle(){this.isEnabled()?this.stop():this.start()}reverse(){this.isEnabled()&&!this.keypoints&&(this.config.autorotateSpeed=-this.config.autorotateSpeed,this.__animate())}disableOnIdle(){this.state.disableOnIdle=!0}__animate(){(s.Wp.isNil(this.config.autorotateZoomLvl)?Promise.resolve(!0):this.viewer.animate({zoom:this.config.autorotateZoomLvl,speed:`${2*this.viewer.config.zoomSpeed}rpm`})).then(e=>{e&&(this.viewer.dynamics.position.roll({yaw:this.config.autorotateSpeed<0},Math.abs(this.config.autorotateSpeed/this.viewer.config.moveSpeed)),s.Wp.isNil(this.config.autorotatePitch)||this.viewer.dynamics.position.goto({pitch:this.config.autorotatePitch},Math.abs(this.config.autorotateSpeed/this.viewer.config.moveSpeed)))})}__reset(){this.state.idx=-1,this.state.curve=[],this.state.startStep=null,this.state.endStep=null,this.state.startTime=null,this.state.stepDuration=null,this.state.remainingPause=null,this.state.lastTime=null,this.state.tooltip=null}__beforeRender(e){(this.state.initialStart||this.config.autostartOnIdle&&!this.state.disableOnIdle)&&this.viewer.state.idleTime>0&&e-this.viewer.state.idleTime>this.config.autostartDelay&&this.start(),this.isEnabled()&&this.keypoints&&(this.state.startTime||(this.state.endStep=c(this.viewer.getPosition()),this.__nextStep(),this.state.startTime=e,this.state.lastTime=e),this.__nextFrame(e))}__shiftKeypoints(){let e=c(this.viewer.getPosition()),t=this.__findMinIndex(this.keypoints,t=>s.Wp.greatArcDistance(t.position,e));this.keypoints.push(...this.keypoints.splice(0,t))}__incrementIdx(){this.state.idx++,this.state.idx===this.keypoints.length&&(this.state.idx=0)}__showTooltip(){let e=this.keypoints[this.state.idx];if(e.tooltip){let t=this.viewer.dataHelper.vector3ToViewerCoords(this.viewer.state.direction);this.state.tooltip=this.viewer.createTooltip({content:e.tooltip.content,position:e.tooltip.position,top:t.y,left:t.x})}else if(e.markerId){let t=this.markers.getMarker(e.markerId);t.showTooltip(),this.state.tooltip=t.tooltip}}__hideTooltip(){if(this.state.tooltip){let e=this.keypoints[this.state.idx];e.tooltip?this.state.tooltip.hide():e.markerId&&this.markers.getMarker(e.markerId).hideTooltip(),this.state.tooltip=null}}__nextPoint(){let e=[];if(-1===this.state.idx){let t=c(this.viewer.getPosition());e.push(t,t,this.keypoints[0].position,this.keypoints[1].position)}else for(let t=-1;t<3;t++){let i=this.state.idx+t<0?this.keypoints[this.keypoints.length-1]:this.keypoints[(this.state.idx+t)%this.keypoints.length];e.push(i.position)}let t=[new r.I9Y(e[0][0],e[0][1])],i=0;for(let s=1;s<=3;s++){let n=e[s-1][0]-e[s][0];n>Math.PI?i+=1:n<-Math.PI&&(i-=1),0!==i&&1===s&&(t[0].x-=2*i*Math.PI,i=0),t.push(new r.I9Y(e[s][0]+2*i*Math.PI,e[s][1]))}let s=new r.xfg(t).getPoints(48).map(e=>[e.x,e.y]);this.state.curve=s.slice(17,33),-1!==this.state.idx?(this.state.remainingPause=this.keypoints[this.state.idx].pause,this.state.remainingPause?this.__showTooltip():this.__incrementIdx()):this.__incrementIdx()}__nextStep(){0===this.state.curve.length&&(this.__nextPoint(),this.state.endStep[0]=s.Wp.parseAngle(this.state.endStep[0])),this.state.startStep=this.state.endStep,this.state.endStep=this.state.curve.shift();let e=s.Wp.greatArcDistance(this.state.startStep,this.state.endStep);this.state.stepDuration=1e3*e/Math.abs(this.config.autorotateSpeed),0===e&&this.__nextStep()}__nextFrame(e){let t=e-this.state.lastTime;if(this.state.lastTime=e,this.state.remainingPause){if(this.state.remainingPause=Math.max(0,this.state.remainingPause-t),this.state.remainingPause>0)return;this.__hideTooltip(),this.__incrementIdx(),this.state.startTime=e}let i=(e-this.state.startTime)/this.state.stepDuration;i>=1&&(this.__nextStep(),i=0,this.state.startTime=e),this.viewer.rotate({yaw:this.state.startStep[0]+(this.state.endStep[0]-this.state.startStep[0])*i,pitch:this.state.startStep[1]+(this.state.endStep[1]-this.state.startStep[1])*i})}__findMinIndex(e,t){let i=0,s=Number.MAX_VALUE;return e.forEach((e,r)=>{let n=t(e);n<s&&(s=n,i=r)}),i}__onKeyPress(e){this.viewer.state.keyboardEnabled&&e.matches(s.aH.KEY_CODES.Space)&&(this.toggle(),e.preventDefault())}};p.id="autorotate",p.VERSION="5.14.0",p.configParser=h,p.readonlyOptions=["keypoints"];var d=p;(0,s.S)(l,"start"),s.zY.lang[l.id]="Automatic rotation"},86340:()=>{},88661:(e,t,i)=>{"use strict";e.exports=i(45688).style}}]);