(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3325],{9540:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]])},35299:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},46694:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var r=a(95155),n=a(12115),s=a(88730),l=a(60230),i=a(66348),d=a(68407),o=a.n(d),c=a(35299);let u=(0,a(71847).A)("rotate-cw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),m=()=>sessionStorage.getItem("token");function x(){let{user:e,student:t}=(0,l.i)(),[a,d]=(0,n.useState)([]),[x,p]=(0,n.useState)(!0),[h,g]=(0,n.useState)(""),[f,b]=(0,n.useState)(null),[v,y]=(0,n.useState)(null),[j,k]=(0,n.useState)(!1),[w,N]=(0,n.useState)(!1),[A,C]=(0,n.useState)({id:"",name:"",mode:"reader"}),_=(null==e?void 0:e.role)==="admin";(0,n.useEffect)(()=>{if(!_)return void p(!1);(async()=>{var e,t,a,r,n;let s=m();if(!s)return p(!1);try{let a=await i.A.get("/lms/devices",{headers:{Authorization:"Bearer ".concat(s)}}),r=Array.isArray(null==(e=a.data)?void 0:e.data)?null==(t=a.data)?void 0:t.data:[];d(r.map(e=>{var t,a,r,n;return{id:String(null!=(t=e.id)?t:""),name:null!=(r=e.name)?r:"Perangkat ".concat(null!=(a=e.id)?a:""),mode:null!=(n=e.mode)?n:"reader",is_active:!!e.is_active,created_at:e.created_at}}))}catch(e){console.error("Gagal mengambil perangkat",e),o().fire({icon:"error",title:"Gagal",text:null!=(n=null==e||null==(r=e.response)||null==(a=r.data)?void 0:a.message)?n:"Tidak dapat memuat data perangkat."})}finally{p(!1)}})()},[_]);let S=(0,n.useMemo)(()=>{if(!h.trim())return a;let e=h.toLowerCase();return a.filter(t=>{var a;return t.name.toLowerCase().includes(e)||(null!=(a=t.mode)?a:"").toLowerCase().includes(e)||t.id.toLowerCase().includes(e)})},[a,h]),T=(e,t)=>{d(a=>a.map(a=>a.id===e?t(a):a))},D=async e=>{var t,a,r,n,s;let l=m();if(!l)return void o().fire({icon:"warning",title:"Token tidak ditemukan"});b(e.id);try{let r=null!=(a=null==(t=(await i.A.patch("/lms/devices/".concat(e.id,"/toggle"),{},{headers:{Authorization:"Bearer ".concat(l)}})).data)?void 0:t.data)?a:null;r?T(e.id,()=>({...e,is_active:!!r.is_active})):T(e.id,e=>({...e,is_active:!e.is_active}))}catch(e){console.error("Gagal mengubah status perangkat",e),o().fire({icon:"error",title:"Gagal",text:null!=(s=null==e||null==(n=e.response)||null==(r=n.data)?void 0:r.message)?s:"Tidak dapat mengubah status perangkat."})}finally{b(null)}},I=async e=>{var t,a,r,n,s;let l=m();if(!l)return void o().fire({icon:"warning",title:"Token tidak ditemukan"});let d="reader"===e.mode?"add_card":"reader";y(e.id);try{let r=null!=(a=null==(t=(await i.A.patch("/lms/devices/".concat(e.id,"/mode"),{mode:d},{headers:{Authorization:"Bearer ".concat(l)}})).data)?void 0:t.data)?a:null;r?T(e.id,()=>({...e,mode:r.mode})):T(e.id,()=>({...e,mode:d}))}catch(e){console.error("Gagal mengubah mode perangkat",e),o().fire({icon:"error",title:"Gagal",text:null!=(s=null==e||null==(n=e.response)||null==(r=n.data)?void 0:r.message)?s:"Tidak dapat mengubah mode perangkat."})}finally{y(null)}},L=async e=>{var t,a,r,n,s;e.preventDefault();let l=m();if(!l)return void o().fire({icon:"warning",title:"Token tidak ditemukan"});if(!A.id.trim()||!A.name.trim())return void o().fire({icon:"warning",title:"Lengkapi data perangkat"});N(!0);try{let e=null!=(a=null==(t=(await i.A.post("/lms/devices",{id:A.id.trim(),name:A.name.trim(),mode:A.mode,is_active:1},{headers:{Authorization:"Bearer ".concat(l)}})).data)?void 0:t.data)?a:null;e&&d(t=>{var a,r,n,s,l;return[{id:String(null!=(a=e.id)?a:A.id),name:null!=(r=e.name)?r:A.name,mode:null!=(n=e.mode)?n:A.mode,is_active:!!(null!=(s=e.is_active)?s:1),created_at:null!=(l=e.created_at)?l:new Date().toISOString()},...t]}),o().fire({icon:"success",title:"Berhasil",text:"Perangkat baru berhasil dibuat."}),k(!1),C({id:"",name:"",mode:"reader"})}catch(e){console.error("Gagal membuat perangkat",e),o().fire({icon:"error",title:"Gagal",text:null!=(s=null==e||null==(n=e.response)||null==(r=n.data)?void 0:r.message)?s:"Tidak dapat membuat perangkat baru."})}finally{N(!1)}};return _?(0,r.jsxs)("div",{className:"overflow-y-auto min-h-screen bg-gray-50",children:[(0,r.jsx)(s.A,{user:e,student:t}),(0,r.jsxs)("section",{className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-800",children:"Manajemen Perangkat IoT"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Kelola perangkat reader dan mode registrasi kartu."})]}),(0,r.jsx)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:(0,r.jsxs)("div",{className:"relative w-full sm:w-72",children:[(0,r.jsx)("input",{type:"text",placeholder:"Cari nama atau ID perangkat...",className:"w-full rounded-md border border-gray-300 bg-white px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500",value:h,onChange:e=>g(e.target.value)}),(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"pointer-events-none absolute right-3 top-2.5 h-5 w-5 text-gray-400",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-4.35-4.35m0 0A7.5 7.5 0 1010.5 3a7.5 7.5 0 006.15 13.65z"})})]})})]}),(0,r.jsx)("div",{className:"overflow-hidden rounded-2xl border border-gray-100 bg-white shadow",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-orange-400 text-sm font-semibold uppercase tracking-wide text-white",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left",children:"No"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left",children:"ID"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left",children:"Nama"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left",children:"Mode"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left",children:"Status"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left",children:"Aktif sejak"}),(0,r.jsx)("th",{className:"px-6 py-3 text-right",children:"Aksi"})]})}),(0,r.jsx)("tbody",{children:x?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:7,className:"px-6 py-10 text-center text-gray-500",children:(0,r.jsxs)("div",{className:"inline-flex items-center gap-2 rounded-xl border border-orange-100 bg-orange-50 px-4 py-2 text-sm text-orange-600",children:[(0,r.jsx)(c.A,{className:"h-4 w-4 animate-spin"})," Memuat perangkat..."]})})}):S.length>0?S.map((e,t)=>{let a=!!e.is_active;return(0,r.jsxs)("tr",{className:"border-t hover:bg-orange-50/40 transition",children:[(0,r.jsx)("td",{className:"px-6 py-3 font-medium text-gray-700",children:t+1}),(0,r.jsx)("td",{className:"px-6 py-3 font-mono text-xs text-gray-500",children:e.id}),(0,r.jsx)("td",{className:"px-6 py-3 text-sm text-gray-800",children:e.name}),(0,r.jsx)("td",{className:"px-6 py-3",children:(0,r.jsxs)("button",{onClick:()=>I(e),disabled:v===e.id,className:"inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold ".concat("reader"===e.mode?"bg-blue-100 text-blue-700":"bg-amber-100 text-amber-700"," disabled:opacity-60"),children:[v===e.id&&(0,r.jsx)(c.A,{className:"h-3.5 w-3.5 animate-spin"}),"reader"===e.mode?"Reader":"Add Card"]})}),(0,r.jsx)("td",{className:"px-6 py-3",children:(0,r.jsx)("span",{className:"rounded-full px-3 py-1 text-xs font-semibold ".concat(a?"bg-emerald-100 text-emerald-700":"bg-rose-100 text-rose-700"),children:a?"Aktif":"Nonaktif"})}),(0,r.jsx)("td",{className:"px-6 py-3 text-sm text-gray-500",children:e.created_at?new Date(e.created_at).toLocaleString("id-ID"):"-"}),(0,r.jsx)("td",{className:"px-6 py-3 text-right",children:(0,r.jsxs)("button",{onClick:()=>D(e),disabled:f===e.id,className:"inline-flex items-center gap-2 rounded-lg border px-3 py-1.5 text-xs font-semibold transition ".concat(a?"border-rose-200 text-rose-600 hover:bg-rose-50":"border-emerald-200 text-emerald-600 hover:bg-emerald-50"," disabled:opacity-60"),children:[f===e.id?(0,r.jsx)(c.A,{className:"h-3.5 w-3.5 animate-spin"}):(0,r.jsx)(u,{className:"h-3.5 w-3.5"}),a?"Nonaktifkan":"Aktifkan"]})})]},e.id)}):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:7,className:"px-6 py-12 text-center text-sm font-medium text-gray-500",children:h?"Tidak ada perangkat yang sesuai pencarian.":"Belum ada perangkat terdaftar."})})})]})})})]}),j?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:(0,r.jsxs)("div",{className:"w-full max-w-md rounded-2xl bg-white shadow-xl",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-100 px-6 py-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:"Tambah Perangkat"}),(0,r.jsx)("button",{onClick:()=>k(!1),className:"rounded-full p-1 text-gray-500 hover:bg-gray-100","aria-label":"Tutup",children:"\xd7"})]}),(0,r.jsxs)("form",{onSubmit:L,className:"grid gap-4 px-6 py-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-600",children:"ID Perangkat"}),(0,r.jsx)("input",{value:A.id,onChange:e=>C(t=>({...t,id:e.target.value})),className:"w-full rounded-xl border border-gray-200 px-4 py-2 text-sm focus:border-orange-500 focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Masukkan ID unik perangkat",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-600",children:"Nama Perangkat"}),(0,r.jsx)("input",{value:A.name,onChange:e=>C(t=>({...t,name:e.target.value})),className:"w-full rounded-xl border border-gray-200 px-4 py-2 text-sm focus:border-orange-500 focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Contoh: Gerbang Depan",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-600",children:"Mode Awal"}),(0,r.jsxs)("select",{value:A.mode,onChange:e=>C(t=>({...t,mode:e.target.value})),className:"w-full rounded-xl border border-gray-200 px-4 py-2 text-sm focus:border-orange-500 focus:outline-none focus:ring-2 focus:ring-orange-200",children:[(0,r.jsx)("option",{value:"reader",children:"Reader"}),(0,r.jsx)("option",{value:"add_card",children:"Add Card"})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-3 border-t border-gray-100 pt-4",children:[(0,r.jsx)("button",{type:"button",onClick:()=>k(!1),className:"rounded-xl border border-gray-200 px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100",children:"Batal"}),(0,r.jsxs)("button",{type:"submit",disabled:w,className:"inline-flex items-center gap-2 rounded-xl bg-orange-500 px-5 py-2 text-sm font-semibold text-white shadow hover:bg-orange-600 disabled:opacity-70",children:[w&&(0,r.jsx)(c.A,{className:"h-4 w-4 animate-spin"}),"Simpan"]})]})]})]})}):null]}):(0,r.jsxs)("div",{className:"overflow-y-auto min-h-screen bg-gray-50",children:[(0,r.jsx)(s.A,{user:e,student:t}),(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 p-6 text-amber-700",children:"Hanya admin yang dapat mengakses manajemen perangkat."})})]})}},60230:(e,t,a)=>{"use strict";a.d(t,{A:()=>l,i:()=>s});var r=a(12115);let n=(0,r.createContext)({user:null,student:null,teacher:null,students:null,teachers:null,tugas:null,subjects:null,exams:null,nilai:null,schedules:null,rooms:null,classes:null}),s=()=>(0,r.useContext)(n),l=n},66348:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(95125),n=a(72378);let s=r.A.create({baseURL:"https://api.smkprestasiprima.sch.id/api",headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{let t=n.A.get("portal-auth-token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e});let l=s},71847:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var r=a(12115);let n=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},s=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,r.forwardRef)((e,t)=>{let{color:a="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:d,className:o="",children:c,iconNode:u,...m}=e;return(0,r.createElement)("svg",{ref:t,...l,width:n,height:n,stroke:a,strokeWidth:d?24*Number(i)/Number(n):i,className:s("lucide",o),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(c)?c:[c]])}),d=(e,t)=>{let a=(0,r.forwardRef)((a,l)=>{let{className:d,...o}=a;return(0,r.createElement)(i,{ref:l,iconNode:t,className:s("lucide-".concat(n(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),d),...o})});return a.displayName=n(e),a}},72378:(e,t,a)=>{"use strict";function r(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)e[r]=a[r]}return e}a.d(t,{A:()=>n});var n=function e(t,a){function n(e,n,s){if("undefined"!=typeof document){"number"==typeof(s=r({},a,s)).expires&&(s.expires=new Date(Date.now()+864e5*s.expires)),s.expires&&(s.expires=s.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var l="";for(var i in s)s[i]&&(l+="; "+i,!0!==s[i]&&(l+="="+s[i].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+l}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var a=document.cookie?document.cookie.split("; "):[],r={},n=0;n<a.length;n++){var s=a[n].split("="),l=s.slice(1).join("=");try{var i=decodeURIComponent(s[0]);if(r[i]=t.read(l,i),e===i)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){n(e,"",r({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,r({},this.attributes,t))},withConverter:function(t){return e(r({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(a)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})},88730:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(95155),n=a(9540);function s(e){let{student:t,user:a,teacher:s}=e,l=window.location.pathname,i=(null==t?void 0:t.class.name)||"Tidak ada kelas",d=(null==a?void 0:a.role)||"guest",o=(null==s?void 0:s.specialization)||"Tidak ada mapel";return(0,r.jsxs)("section",{id:"header",className:"w-full flex items-center justify-between p-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("button",{className:"lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors",onClick:()=>{window.dispatchEvent(new CustomEvent("toggleSidebar"))},children:(0,r.jsx)(n.A,{className:"w-6 h-6"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl sm:text-2xl font-bold",children:(()=>{switch(!0){case l.startsWith("/edu/dashboard"):return"Dashboard ".concat("admin"===d?"Admin":"guru"===d?"Guru":"Siswa");case l.startsWith("/edu/tugas"):return"Tugas Anda";case l.startsWith("/edu/ujian"):return"Ujian Anda";case l.startsWith("/edu/nilai"):return"Nilai Anda";case l.startsWith("/edu/jadwal"):return"Jadwal";case l.startsWith("/edu/setelan"):return"Setelan";case l.startsWith("/edu/perangkat"):return"Perangkat";case l.startsWith("/edu/rfid"):return"RFID Card";default:return""}})()}),(0,r.jsxs)("p",{className:"text-black/60 text-sm sm:text-base",children:["Selamat datang kembali, ",(null==a?void 0:a.name)||"Loading...","."]})]})]}),(0,r.jsx)("p",{className:"bg-emerald-200 text-emerald-800 px-3 py-2 text-xs sm:text-sm rounded-sm",children:(null==a?void 0:a.role)==="siswa"?i.replaceAll("-"," "):(null==a?void 0:a.role)==="guru"?o.replaceAll("-"," "):(null==a?void 0:a.role)==="admin"?"Administrator":"Tamu"})]})}a(12115)},90516:(e,t,a)=>{Promise.resolve().then(a.bind(a,46694))}},e=>{e.O(0,[8320,5125,8441,1255,7358],()=>e(e.s=90516)),_N_E=e.O()}]);